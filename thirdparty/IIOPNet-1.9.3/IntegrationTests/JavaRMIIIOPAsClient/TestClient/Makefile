include ..\..\..\MakeVars

IDLSource=..\TestServer\IDL\Ch\Elca\Iiop\IntegrationTests\*.idl
TestService=Ch\Elca\Iiop\IntegrationTests\ 

build: build-idl build-java

build-idl:
	if not exist IDL\nul mkdir IDL
	copy ..\..\..\IDL\*.idl IDL
	xcopy /s /y ..\TestServer\IDL IDL
	cd IDL
	idlj -td .. $(TestService)TestService.idl 
	idlj -td .. $(TestService)Adder.idl 
	idlj -td .. $(TestService)TestAbstrInterfaceImplByMarshalByVal.idl
	idlj -td .. $(TestService)TestEchoInterface.idl
	idlj -td .. $(TestService)TestEnum.idl
	idlj -td .. $(TestService)TestEnumBI16.idl
	idlj -td .. $(TestService)TestEnumUI32.idl
	idlj -td .. $(TestService)TestEnumBI64.idl
	idlj -td .. $(TestService)TestInterfaceA.idl
	idlj -td .. $(TestService)TestNonSerializableBaseClass.idl
	idlj -td .. $(TestService)TestSerializableClassB1.idl
	idlj -td .. $(TestService)TestSerializableClassB2.idl
	idlj -td .. $(TestService)TestSerializableClassC.idl
	idlj -td .. $(TestService)TestSerializableClassD.idl
#without emitAll idlj doesn't generate any definition; that's also valid, if def would have been generated by rmic
	idlj -td .. -emitAll $(TestService)TestSerializableClassE.idl
	idlj -td .. $(TestService)TestStructA.idl
	idlj -td .. org\omg\BoxedArray\_System\seq1_long.idl
	idlj -td .. org\omg\BoxedArray\_System\seq1_octet.idl
	idlj -td .. org\omg\BoxedArray\_System\seq1_wstring.idl
	idlj -td .. org\omg\BoxedArray\_System\seq2_long.idl
	idlj -td .. org\omg\BoxedArray\_System\seq2_octet.idl
	idlj -td .. org\omg\BoxedArray\_System\seq2_wstring.idl
	idlj -td .. org\omg\BoxedArray\_System\seq3_octet.idl
	idlj -td .. Ch\Elca\Iiop\GenericUserException.idl
	idlj -td .. Predef.idl
	cd ..

copy-valuetypeImpls:
        copy valTypeImpls\*.java $(TestService)

build-java: junit-var copy-valuetypeImpls compile-java

compile-java: $(TestService)*.java *.java
	javac -classpath .;$(JUNIT_JAR) $?

start-client:
	@echo "java client IntegrationTest"
	java -Djava.naming.factory.initial=com.sun.jndi.cosnaming.CNCtxFactory -Djava.naming.provider.url=iiop://localhost:8087 -cp .;$(JUNIT_JAR) TestClient

clean:
	if exist IDL\nul rmdir /q /s IDL
	if exist org\nul rmdir /q /s org
        if exist Ch\nul rmdir /q /s Ch
	if exist *.class del /q *.class


